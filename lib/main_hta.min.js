function readFile(e){var t=1,n=-2,o=new ActiveXObject("Scripting.FileSystemObject");if(o.fileExists(e)){s="";try{f=o.GetFile(e);for(var a=f.OpenAsTextStream(t,n);!a.AtEndOfStream;)s=s+a.readline()+"\n"}catch(t){return $("#out").val("!! Error reading file, "+e+"!!"),""}finally{a.close()}return s}return!1}function writeFile(e,t){var n=2;try{var o=new ActiveXObject("Scripting.FileSystemObject");f=o.OpenTextFile(e,n,!0),f.Write(t)}catch(t){return $("#out").val("!! Error reading file, "+e+"!!"),""}finally{f.Close()}}function really_go(e,t,n,o){for(;t.includes("@");)t=t.replace("@",e);if(n){if(""===e)return log("Remote host must be filled in."),blink_element($("#host")),!1;t=config.remote+" \\\\"+e+" "+t}debug(t),oShell=new ActiveXObject("WScript.shell"),$("body").addClass("busy");try{if(o){for(oExec=oShell.Exec(t),output="";!oExec.StdOut.AtEndOfStream;)output+=oExec.StdOut.ReadLine()+"\n";for(;!oExec.StdErr.AtEndOfStream;)output+=oExec.StdErr.ReadLine()+"\n";log("Executing program#: "+t+"\n"+output)}else log("Executing program: "+t),bWaitOnReturn=!1,intWindowStyle=1,oShell.run(t,intWindowStyle,bWaitOnReturn)}catch(e){log("Unable to perform action: "+t+". Check that the path is correct.")}finally{$("body").removeClass("busy")}}function go(e,t,n){return e=trim_char(e.trim(),","),t.includes("@")&&""==e.trim()?(log("Please enter a host"),blink_element($("#host")),!1):(cmdline=!1,"#"===t[0]&&(t=t.substring(1),cmdline=!0),t.includes("@")&&e.includes(",")?(e=e.split(","),$.each(e,function(e,o){really_go(o.trim(),t,n,cmdline)}),!0):void really_go(e.trim(),t,n,cmdline))}function debug(e){bDebug&&log(e)}function log(e){d=new Date,$("#out").val(d.toUTCString()+": "+e+"\n"+$("#out").val())}function show_desc(){node=$("#tree").jstree(!0).get_selected(!0),node=node[0],s="",node.text&&(s+=node.text+"<br>"),node.data.cmd&&(s+="Command: "+node.data.cmd+"<br>"),node.data.param&&(s+="Paramenters: "+node.data.param+"<br>"),node.data.desc&&(s+="Description: "+node.data.desc+"<br>"),node.data.www&&(s+='Web: <a href="'+node.data.www+'" class=external target=_blank>'+node.data.www+"</a><br>"),node.data.url&&(s+='File: <a href="'+node.data.url+'" class=external target=_blank>'+node.data.url+"</a><br>"),node.data.license&&(s+="License: "+node.data.license+"<br>"),""==s?$("#desc").html("No details to show"):$("#desc").html(s)}function show_edit(e,t,n,o,a,r,i,s,d){s=s?encode(s):"",d=d?encode(d):"",a=a?encode(a):"",i=i?encode(i):"",o=o?encode(o):"",r=r?encode(r):"",$("#desc").html("<form id=form_tool><input type=hidden id=parent value='"+n+"'><label>Name:</label><input id=text value='"+t+"'><label>Description:</label><input id=desc1 value='"+r+"'><label>Command:</label><input id=cmd value='"+o+"'><label>Parameters:</label><input id=param1 value='"+a+"'><label>WWW:</label><input id=www value='"+i+"'><label>License:</label><input id=license value='"+s+"'><label>URL:</label><input id=url value='"+d+'\'><div><input id=btnCancel type="button" value=Cancel onclick="show_desc()" style="width:30%;margin-left:60px"><input type=button id=btnSave onclick="save_edit(this.form)" value=Save></div></form>'),$("#text").focus(),$("#text").select(),$("#form_tool").dirrty({preventLeaving:!1}).on("dirty",function(){$("#btnSave").prop("disabled",!1)}).on("clean",function(){$("#btnSave").prop("disabled",!0)})}function save_edit(e){return $("#form_tool").dirrty("isDirty")?""===e.cmd.value||""===e.text.value?(log("Name and Command must be filled in"),!1):(obj={},obj.id=e.parent.value.trim()+"-"+e.text.value.trim(),obj.text=e.text.value.trim(),obj.data={},obj.data.cmd=e.cmd.value.trim(),obj.data.param=e.param1.value.trim(),obj.data.desc=e.desc1.value.trim(),obj.data.www=e.www.value.trim(),obj.data.url=e.url.value.trim(),obj.data.license=e.license.value.trim(),selected_node=jstree.jstree(!0).get_selected(!0),selected_node[0].text!==obj.text&&(json=jstree.jstree(!0).get_json(e.parent.value,{flat:!0}),texts=jsonQ(json).find("text").value(),$.inArray(obj.text,texts)>-1)?(log("Name conflicts with existing node. Must be unique."),blink_element($("#text")),!1):(log("Saved "+obj.text),selected_node[0].data=obj.data,jstree.jstree(!0).set_text(selected_node[0],obj.text),set_id(selected_node[0],obj.id),show_desc(),show_preview(selected_node[0]),void write_category(selected_node[0].parent))):(log("No changes to save"),!1)}function encode(e){return e=e.replace(/'/gim,"&apos;")}function check_duplicate_text(e,t){var o=!1;return $.each(e.children,function(e,a){if(n=$("#tree").jstree(!0).get_node(a),n.text===t)return o=!0}),o}function write_category(e){json=jstree.jstree(!0).get_json(e,{flat:!0}),json.shift(),container=[],$.each(json,function(e,t){new_obj={},new_obj.text=t.text,new_obj.cmd=t.data.cmd,new_obj.desc=t.data.desc,new_obj.www=t.data.www,new_obj.license=t.data.license,new_obj.url=t.data.url,new_obj.param=t.data.param,container.push(new_obj)}),filename="json\\"+e.replace(/(.*?)-/,"")+".json",writeFile(filename,JSON.stringify(container)),debug("Write tool 1: "+filename)}function update_children_ids(e){return json=jstree.jstree(!0).get_json(e,{flat:!0}),0==json||json.length<2?(debug("update_children_ids, no children: "+e),!1):(debug("update_children_ids: "+e),json.shift(),void $.each(json,function(e,t){t=jstree.jstree(!0).get_node(t.id),set_id(t,t.parent+"-"+t.text)}))}function set_id(e,t){anchor=t+"_anchor",$("#"+fix_jquery_selector(e.id)+"_anchor").attr("id",anchor),$("#"+fix_jquery_selector(e.id)).attr("aria-labelledby",anchor),e.a_attr.id=anchor,jstree.jstree(!0).set_id(e,t)}function delete_node(e){switch(e.type){case"0":log("Not allowed to delete root");break;case"1":answer=confirm("Really delete category?"),answer&&(index=$.inArray(e.text,config.categories),config.categories.splice(index,1),writeFile("settings.json",JSON.stringify(config)),debug("Write File 1: settings.json"),fso.fileExists("json\\"+e.text+".json")&&(fso.DeleteFile("json\\"+e.text+".json"),debug("DeleteFile json\\"+e.text+".json")),jstree.jstree("delete_node",e),$("#desc").html(""));break;case"2":answer=confirm("Really delete tool?"),answer&&(jstree.jstree("delete_node",e),write_category(e.parent),$("#desc").html(""))}}function show_preview(e){if(debug("show preview"),e){if(void 0==e.data.cmd)return!1;hosts=$("#host").val().trim(),action=e.data.cmd,action.includes("@")&&""!=hosts&&action.replace(/@/,hosts),cmdline=!1,"#"===action[0]&&(action=action.substring(1),cmdline=!0),param=$("#param").val().trim(),params=""==param?[]:param.split(",");for(var t=0;t<params.length;t++)params[t].trim()&&(action=action.replace("#",params[t]));cmdline?$("#preview").val("#"+action):$("#preview").val(action)}}String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1};var jstree=null,bDebug=!1,fso=new ActiveXObject("Scripting.FileSystemObject");$("#search").val(""),$("#preview").val(""),$("#out").val("");var jstree=null,last_clicked=null,node_type=null;$(document).ready(function(){var e=!1;if(window.moveTo(0,0),window.resizeTo(screen.width,screen.height),$("#desc").html(""),fso.fileExists("json\\quickTools.json")){try{qt=JSON.parse(readFile("json\\quickTools.json"))}catch(e){debug("!! Error reading json\\quickTools.json!!")}$.each(qt,function(e,t){$(".dropdown-menu").append("<a class='dropdown-item' href='#'>"+t.text+"</a>").data(),$.data(document.body,t.text,t.cmd),t.default&&($("#quickTools").text(t.text),$("#quickTools").val(t.text),$.data(document.body,"quickTools",t.cmd))})}else debug("!! Error reading json\\quickTools.json. Make sure file exists!!"),e=!0;if(debug("Reading settings.json"),fso.fileExists("settings.json"))try{config=JSON.parse(readFile("settings.json"))}catch(e){return $("#out").val("!! Error reading settings.json. Please validate the JSON data!!"),!1}else $("#out").val("!! Error reading settings.json. Make sure file exists!!"),e=!0;config.sort_categories&&(debug("Sorting categories"),config.categories=config.categories.quickSort()),debug("Populating jstree"),root_id="0",cats=[],$.each(config.categories,function(t,n){cats.push({id:root_id+"-"+n,text:n,type:"1",data:{previous_text:n}}),debug("\tReading json\\"+n+".json");try{tools=JSON.parse(readFile("json\\"+n+".json"))}catch(t){log("!! Error reading json\\"+n+".json. Please validate the JSON data!!"),e=!0}$.each(tools,function(e,t){t.cmd&&(tools[e].id=root_id+"-"+n+"-"+t.text,tools[e].text=t.text,tools[e].type="2",tools[e].data={desc:t.desc,www:t.www,license:t.license,url:t.url,param:t.param,cmd:t.cmd,previous_text:t.text})}),cats[t].children=tools}),e?log("Loading complete with errors"):$("#out").val("Loading Complete"),config.sort_tools&&(jsonQ.settings.sort.caseIgnore=!0,cats=jsonQ(cats).sort("text").jsonQ_root),jsondata=[{id:root_id,text:"TechTools",type:"0",state:{opened:!0},children:cats,data:{disable_close:!0}}],jstree=$("#tree").jstree({core:{check_callback:function(e,t,n,o,a){switch(e){case"rename_node":return"0"===t.type;case"move_node":return"2"===t.type&&"1"===n.type;default:return!0}},scroll:!0,dblclick_toggle:!1,multiple:!1,animation:0,data:jsondata},plugins:["unique","search","contextmenu","types","dnd"],contextmenu:{items:function(e){return right_click=!0,debug("contextmenu"),"0"===e.type?{Create:{separator_before:!1,separator_after:!1,label:"Create",action:function(t){for(node_type="1",duplicate=!0,i=0;duplicate;)text="New Category",i>0&&(text+=" "+i),1==check_duplicate_text(e,text)?i++:(duplicate=!1,new_obj={id:e.id+"-"+text,text:text,type:"1",parent:"0",children:[],data:{previous_text:text}},jstree.jstree("create_node",e.id,new_obj,"first"),config.categories.unshift(text),writeFile("settings.json",JSON.stringify(config)),debug("Write File 1: settings.json"),debug("Create Empty File: "+new_obj.id+".json"),writeFile("json\\"+new_obj.id.replace(/(.*?)-/,"")+".json","[]"),jstree.jstree("edit",new_obj.id,!1))}}}:"1"===e.type?{Create:{separator_before:!1,separator_after:!1,label:"Create",action:function(t){for(node_type="2",duplicate=!0,i=0;duplicate;)text="New Tool",i>0&&(text+=" "+i),1==check_duplicate_text(e,text)?i++:(duplicate=!1,new_obj={id:e.id+"-"+text,text:text,type:"2",parent:e.parent,data:{cmd:text,desc:"",www:"",license:"",url:"",param:"",previous_text:text}},debug("node.parent "+e.parent),jstree.jstree("create_node",e.id,new_obj,"first"),debug("create tool "+e.text),write_category(e.id),debug("Write File: "+e.id+".json"))}},Edit:{separator_before:!1,separator_after:!1,label:"Edit",action:function(t){jstree.jstree("edit",e)}},Delete:{separator_before:!1,separator_after:!1,label:"Delete",action:function(t){delete_node(e)}}}:{Edit:{separator_before:!1,separator_after:!1,label:"Edit",action:function(t){show_edit(e.id,e.text,e.parent,e.data.cmd,e.data.desc,e.data.www,e.data.license,e.data.url)}},Delete:{separator_before:!1,separator_after:!1,label:"Delete",action:function(t){delete_node(e)}}}}},dnd:{"is-draggable":!0,"check-while-dragging":!0,drag_selection:!1},types:{0:{max_children:1},1:{},2:{}}}),jstree.on("create_node.jstree",function(e,t){debug("create_node.jstree"),"2"==t.node.type&&show_edit(t.node.id,t.node.text,t.node.parent,t.node.data.cmd,t.node.data.param,t.node.data.desc,t.node.data.www,t.node.data.license,t.node.data.url),jstree.jstree(!0).select_node(t.node.id),jstree.jstree(!0).deselect_node(t.node.parent)}),jstree.on("keydown.jstree",".jstree-anchor",function(e){e.keyCode>=37&&e.keyCode<=40&&(debug("keydown"),node=jstree.jstree(!0).get_selected(!0),"2"===node[0].type&&(show_desc(),show_preview(node)))}),jstree.on("rename_node.jstree",function(e,t){var n=t.node;if(n.text===n.data.previous_text)return log("Nothing changed"),!1;if("0"===n.type)return log("Renaming root is not allowed"),!1;if(debug("rename_node.jstree"),"1"===n.type){if(cat_index=$.inArray(n.data.previous_text,config.categories),config.categories[cat_index]=n.text,writeFile("settings.json",JSON.stringify(config)),debug("Update settings.json"),fso.fileExists("json\\"+n.data.previous_text+".json"))try{fso.MoveFile("json\\"+n.data.previous_text+".json","json\\"+n.text+".json"),debug("Move File:json\\"+n.data.previous_text+".json, json\\"+n.text+".json")}catch(e){log("Failed to rename file: json\\"+n.data.previous_text+".json")}set_id(n,n.parent+"-"+n.text),n.data.previous_text=n.text,update_children_ids(n.text)}else"2"===n.type&&(set_id(n,n.parent+"-"+n.text),write_category(n.parent),show_desc());right_click=!1}),jstree.on("select_node.jstree",function(e,t){debug("node.id: "+t.node.id)}),jstree.on("click",".jstree-anchor",function(e,t){$("#search").val(""),$("#tree").jstree(!0).toggle_node(e.target);var e=window.event||event,n=e.which||e.button;3==n||($("#desc").html(""),node=$("#tree").jstree(!0).get_node($(".jstree-clicked").attr("id")),"2"===node.type&&(show_desc(),show_preview(node)))}),jstree.on("dblclick",".jstree-anchor",function(e){nodes=jstree.jstree("get_selected",!0),nodes.length>0&&"2"==nodes[0].type&&show_edit(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url)}),jstree.on("open_node.jstree",function(e,t){var n=[];$("#"+t.node.id).parents(".jstree-node").each(function(){n.push(this.id)}),n.push(t.node.id),$(".jstree-node").each(function(){n.indexOf(this.id)===-1&&$("#tree").jstree().close_node(this.id)})}),$(document).on("dnd_stop.vakata",function(e,t){var o=jstree.jstree(!0).get_node(t.data.nodes[0]),a=jstree.jstree(!0).get_node($(t.event.target));n=o.id.split("-"),s="",previous_node_text="";for(var r=0;r<2;r++)s+=n[r]+"-",1==r&&(previous_node_text=n[r]);jstree.jstree(!0).set_id(t.data.nodes[0],o.id.replace(s,o.parent+"-")),debug("New ID: "+o.id),write_category(a.id),write_category(trim_char(s,"-"))}),$("#run").on("click",function(e,t){return t=t||!1,""===$("#preview").val().trim()?(log("Nothing to run"),!1):(param=$("#param").val().trim(),param.includes("#")?(log("Param should not have #"),blink_element($("#param")),!1):$("#host").val().includes("@")?(log("Host should not have @"),blink_element($("#host")),!1):(params_entered=""===param?[]:param.split(",").map(function(e){return e.trim()}),params_entered=params_entered.filter(Boolean),node=jstree.jstree(!0).get_selected(!0)[0],node&&(action=node.data.cmd,action="#"===action[0]?action=action.substring(1):action,needed_count=(action.match(/#/g)||[]).length,needed_count>params_entered.length)?(log("Not enough parameters"),blink_element($("#param")),!1):void go($("#host").val(),$("#preview").val(),t)))}),$("#remote").on("click",function(e){$("#run").trigger("click",!0)}),$("#param").on("keyup",function(){node=jstree.jstree("get_selected",!0),show_preview(node[0])}),$("#optimize").on("click",function(e){really_go("",config.optimize,"",!1)}),$(".dropdown-item").on("click",function(e){$("#quickTools").text($(this).text()),$("#quickTools").val($(this).text()),$.data(document.body,"quickTools",$.data(document.body,$(this).text())),$("#quickTools").trigger("click")}),$("#quickTools").on("click",function(){go($("#host").val(),$.data(document.body,"quickTools"),!1)}),$("#copy").on("click",function(){""!=$("#out").val()&&copyToClipboard(document.getElementById("out"))}),$("#save_output").on("click",function(){""!=$("#out").val()&&(d=(new Date).toLocaleString().replace(/(\/|\:)/g,"_"),date_string=d.replace(",",""),filename=window.prompt("Enter filename","c:\\techtools_"+date_string+".txt"),filename&&(filename=filename.trim(),filename.length>0&&writeFile(filename,$("#out").val())))}),$("#clear").on("click",function(){$("#out").val("")});var t=!1;$("#search").keyup(function(){t&&clearTimeout(t),t=setTimeout(function(){var e=$("#search").val();$("#tree").jstree(!0).search(e)},250)}),$(document).on("click","a[href]",function(e){e.preventDefault(),"external"===e.target.className&&openURL(e.target.href)}),jwerty.key("alt+d",function(e){nodes=jstree.jstree(!0).get_selected(!0),delete_node(node[0])}),jwerty.key("alt+e",function(e){return nodes=jstree.jstree(!0).get_selected(!0),"1"===nodes[0].type?jstree.jstree(!0).edit(nodes[0]):"2"===nodes[0].type?show_edit(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url):log("Edit function not available at this time. Select a tool first."),!1}),jwerty.key("alt+r",function(e){$("#run").trigger("click")}),jwerty.key("alt+m",function(e){return $("#remote").trigger("click"),!1}),jwerty.key("alt+o",function(e){return $("#optimize").trigger("click"),!1}),jwerty.key("alt+q",function(e){return $("#quicktools").trigger("click"),!1}),jwerty.key("alt+s",function(e){return $("#form_tool").length>0?$("#btnSave").trigger("click"):log("Save function not available at this time. Select a tool first."),!1}),jwerty.key("alt+c",function(e){$("#out").val("")}),jwerty.key("esc",function(e){$("#btnCancel").length>0&&$("#btnCancel").trigger("click")}),$(".clearable").each(function(){var e=$(this).find("input:text"),t=$(this).find(".clearable__clear");e.on("input",function(){t.toggle(!!this.value)}),t.on("touchstart click",function(t){t.preventDefault(),e.val("").trigger("input"),node=jstree.jstree(!0).get_selected(!0),show_preview(node[0])})})});
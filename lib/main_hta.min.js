String.prototype.includes=function(search,start){if(typeof start!=='number'){start=0}
if(start+search.length>this.length){return!1}else{return this.indexOf(search,start)!==-1}};var jstree=null
var bDebug=!1
var fso=new ActiveXObject("Scripting.FileSystemObject")
$("#search").val("")
$("#preview").val("")
$("#out").val("")
function readFile(filename){var ForReading=1,ForWriting=2,ForAppending=8;var TristateUseDefault=-2,TristateTrue=-1,TristateFalse=0;var fso=new ActiveXObject("Scripting.FileSystemObject")
if(fso.fileExists(filename)){s=''
try{f=fso.GetFile(filename);var stream=f.OpenAsTextStream(ForReading,TristateUseDefault)
while(!stream.AtEndOfStream){s=s+stream.readline()+"\n"}}catch(e){$("#out").val("!! Error reading file, "+filename+'!!')
return('')}finally{stream.close()}
return(s)}else{return(!1)}}
function writeFile(filename,text){var ForReading=1,ForWriting=2,ForAppending=8;var TristateUseDefault=-2,TristateTrue=-1,TristateFalse=0;try{var fso=new ActiveXObject("Scripting.FileSystemObject")
f=fso.OpenTextFile(filename,ForWriting,!0)
f.Write(text)}catch(e){$("#out").val("!! Error reading file, "+filename+'!!')
return('')}finally{f.Close()}}
function really_go(host,action,remote,cmdline){while(action.includes("@")){action=action.replace("@",host)}
if(remote){if(host===""){log("Remote host must be filled in.")
blink_element($("#host"))
return(!1)}else{action=config.remote+" \\\\"+host+" "+action}}
debug(action)
oShell=new ActiveXObject("WScript.shell");$('body').addClass('busy')
try{if(cmdline){oExec=oShell.Exec(action)
output=""
while(!oExec.StdOut.AtEndOfStream){output+=oExec.StdOut.ReadLine()+"\n"}
while(!oExec.StdErr.AtEndOfStream){output+=oExec.StdErr.ReadLine()+"\n"}
log("Executing program#: "+action+"\n"+output)}else{log("Executing program: "+action)
bWaitOnReturn=!1
intWindowStyle=1
oShell.run(action,intWindowStyle,bWaitOnReturn)}}catch(e){log("Unable to perform action: "+action+". Check that the path is correct.")}finally{$('body').removeClass('busy')}}
function go(hosts,action,remote){hosts=trim_char(hosts.trim(),",")
if(action.includes("@")&&hosts.trim()==""){log("Please enter a host")
blink_element($("#host"))
return(!1)}
cmdline=!1
if(action[0]==="#"){action=action.substring(2.-1)
cmdline=!0}
if(action.includes("@")){if(hosts.includes(",")){hosts=hosts.split(",")
$.each(hosts,function(i,host){really_go(host.trim(),action,remote,cmdline)})
return(!0)}}
really_go(hosts.trim(),action,remote,cmdline)}
function debug(text){if(bDebug){log(text)}}
function log(text){d=new Date
$('#out').val(d.toUTCString()+": "+text+"\n"+$('#out').val())}
function show_desc(){node=$("#tree").jstree(!0).get_selected(!0)
node=node[0]
s=""
if(node.text){s+=node.text+"<br>"}
if(node.data.cmd){s+="Command: "+node.data.cmd+"<br>"}
if(node.data.param){s+="Paramenters: "+node.data.param+"<br>"}
if(node.data.desc){s+="Description: "+node.data.desc+"<br>"}
if(node.data.www){s+="Web: <a href=\""+node.data.www+"\" class=external target=_blank>"+node.data.www+"</a><br>"}
if(node.data.url){s+="File: <a href=\""+node.data.url+"\" class=external target=_blank>"+node.data.url+"</a><br>"}
if(node.data.license){s+="License: "+node.data.license+"<br>"}
if(s==""){$("#desc").html("No details to show")}else{$("#desc").html(s)}}
function show_edit(id,text,parent,cmd,param,desc,www,license,url){license=(license)?encode(license):''
url=(url)?encode(url):''
param=(param)?encode(param):''
www=(www)?encode(www):''
cmd=(cmd)?encode(cmd):''
desc=(desc)?encode(desc):''
$("#desc").html("<form id=form_tool><input type=hidden id=parent value='"+parent+"'><label>Name:</label><input id=text value='"+text+"'><label>Description:</label><input id=desc1 value='"+desc+"'><label>Command:</label><input id=cmd value='"+cmd+"'><label>Parameters:</label><input id=param1 value='"+param+"'><label>WWW:</label><input id=www value='"+www+"'><label>License:</label><input id=license value='"+license+"'><label>URL:</label><input id=url value='"+url+"'><div><input id=btnCancel type=\"button\" value=Cancel onclick=\"show_desc()\" style=\"width:30%;margin-left:60px\"><input type=button id=btnSave onclick=\"save_edit(this.form)\" value=Save></div></form>")
$("#text").focus()
$("#text").select()
$('#form_tool').dirrty({preventLeaving:!1}).on("dirty",function(){$("#btnSave").prop('disabled',!1)}).on("clean",function(){$("#btnSave").prop('disabled',!0)})}
function save_edit(f){if(!$("#form_tool").dirrty("isDirty")){log("No changes to save")
return(!1)}
if((f.cmd.value==="")||(f.text.value==="")){log("Name and Command must be filled in")
return(!1)}
obj={}
obj.id=f.parent.value.trim()+"-"+f.text.value.trim()
obj.text=f.text.value.trim()
obj.data={}
obj.data.cmd=f.cmd.value.trim()
obj.data.param=f.param1.value.trim()
obj.data.desc=f.desc1.value.trim()
obj.data.www=f.www.value.trim()
obj.data.url=f.url.value.trim()
obj.data.license=f.license.value.trim()
selected_node=jstree.jstree(!0).get_selected(!0)
if(selected_node[0].text!==obj.text){json=jstree.jstree(!0).get_json(f.parent.value,{flat:!0})
texts=jsonQ(json).find("text").value()
if($.inArray(obj.text,texts)>-1){log("Name conflicts with existing node. Must be unique.")
blink_element($("#text"))
return(!1)}}
log("Saved "+obj.text)
selected_node[0].data=obj.data
jstree.jstree(!0).set_text(selected_node[0],obj.text)
set_id(selected_node[0],obj.id)
show_desc()
show_preview(selected_node[0])
write_category(selected_node[0].parent)}
function encode(str){str=str.replace(/'/igm,"&apos;")
return(str)}
function check_duplicate_text(node,match){var check=!1
$.each(node.children,function(index,text){n=$("#tree").jstree(!0).get_node(text)
if(n.text===match){check=!0
return(check)}});return(check)}
function write_category(node_id){json=jstree.jstree(!0).get_json(node_id,{flat:!0})
json.shift()
container=[]
$.each(json,function(i,obj){new_obj={}
new_obj.text=obj.text
new_obj.cmd=obj.data.cmd
new_obj.desc=obj.data.desc
new_obj.www=obj.data.www
new_obj.license=obj.data.license
new_obj.url=obj.data.url
new_obj.param=obj.data.param
container.push(new_obj)})
filename="json\\"+node_id.replace(/(.*?)-/,"")+".json"
writeFile(filename,JSON.stringify(container))
debug("Write tool 1: "+filename)}
function update_children_ids(new_id){json=jstree.jstree(!0).get_json(new_id,{flat:!0})
if((json==!1)||(json.length<2)){debug("update_children_ids, no children: "+new_id)
return(!1)}
debug("update_children_ids: "+new_id)
json.shift()
$.each(json,function(i,node){node=jstree.jstree(!0).get_node(node.id)
set_id(node,node.parent+"-"+node.text)})}
function set_id(node,new_id){anchor=new_id+"_anchor"
$("#"+fix_jquery_selector(node.id)+"_anchor").attr("id",anchor)
$("#"+fix_jquery_selector(node.id)).attr("aria-labelledby",anchor)
node.a_attr.id=anchor
jstree.jstree(!0).set_id(node,new_id)}
function delete_node(node){switch(node.type){case "0":log("Not allowed to delete root")
break
case "1":answer=confirm('Really delete category?')
if(answer){index=$.inArray(node.text,config.categories)
config.categories.splice(index,1)
writeFile("settings.json",JSON.stringify(config))
debug("Write File 1: "+"settings.json")
if(fso.fileExists("json\\"+node.text+".json")){fso.DeleteFile("json\\"+node.text+".json")
debug("DeleteFile "+"json\\"+node.text+".json")}
jstree.jstree('delete_node',node);$("#desc").html('')}
break
case "2":answer=confirm('Really delete tool?')
if(answer){jstree.jstree('delete_node',node);write_category(node.parent)
$("#desc").html('')}
break}}
var jstree=null
var last_clicked=null
var node_type=null
$(document).ready(function(){var errors=!1
window.moveTo(0,0)
window.resizeTo(screen.width,screen.height)
$('#desc').html('')
if(fso.fileExists("json\\quickTools.json")){try{qt=JSON.parse(readFile('json\\quickTools.json'))}catch(e){debug("!! Error reading json\\quickTools.json!!")}
$.each(qt,function(i,val){$(".dropdown-menu").append("<a class='dropdown-item' href='#'>"+val.text+"</a>").data()
$.data(document.body,val.text,val.cmd)
if(val.default){$("#quickTools").text(val.text);$("#quickTools").val(val.text);$.data(document.body,"quickTools",val.cmd)}})}else{debug("!! Error reading json\\quickTools.json. Make sure file exists!!")
errors=!0}
debug('Reading settings.json')
if(fso.fileExists('settings.json')){try{config=JSON.parse(readFile("settings.json"))}catch(e){$("#out").val("!! Error reading settings.json. Please validate the JSON data!!")
return(!1)}}else{$("#out").val("!! Error reading settings.json. Make sure file exists!!")
errors=!0}
if(config.sort_categories){debug('Sorting categories')
config.categories=config.categories.quickSort()}
debug('Populating jstree')
root_id="0"
cats=[]
$.each(config.categories,function(i,cat){cats.push({"id":root_id+"-"+cat,"text":cat,"type":"1","data":{"previous_text":cat},})
debug("\t"+'Reading json\\'+cat+'.json')
try{tools=JSON.parse(readFile('json\\'+cat+'.json'))}catch(e){log("!! Error reading json\\"+cat+".json. Please validate the JSON data!!")
errors=!0}
$.each(tools,function(j,tool){if(tool.cmd){tools[j].id=root_id+"-"+cat+"-"+tool.text
tools[j].text=tool.text
tools[j].type="2"
tools[j].data={"desc":tool.desc,"www":tool.www,"license":tool.license,"url":tool.url,"param":tool.param,"cmd":tool.cmd,"previous_text":tool.text}}})
cats[i].children=tools})
if(errors){log("Loading complete with errors")}else{$("#out").val('Loading Complete')}
if(config.sort_tools){jsonQ.settings.sort.caseIgnore=!0;cats=jsonQ(cats).sort('text').jsonQ_root}
jsondata=[{"id":root_id,"text":"TechTools","type":"0","state":{"opened":!0},"children":cats,"data":{"disable_close":!0}}]
jstree=$('#tree').jstree({'core':{'check_callback':function(operation,node,node_parent,node_position,more){switch(operation){case 'rename_node':return(node.type==="1")
break
case 'move_node':return(node.type==="2"&&node_parent.type==='1')
break
default:return(!0)}},"scroll":!0,"dblclick_toggle":!1,"multiple":!1,"animation":0,'data':jsondata},"plugins":["unique","search","contextmenu","types","dnd"],'contextmenu':{"items":function(node){right_click=!0
debug("contextmenu")
if(node.type==="0"){return{"Create":{"separator_before":!1,"separator_after":!1,"label":"Create","action":function(obj){node_type="1"
duplicate=!0
i=0
while(duplicate){text="New Category"
if(i>0){text+=" "+i}
if(check_duplicate_text(node,text)==!0){i++}else{duplicate=!1
new_obj={"id":node.id+"-"+text,"text":text,"type":"1","parent":"0","children":[],data:{"previous_text":text}}
jstree.jstree("create_node",node.id,new_obj,"first");config.categories.unshift(text)
writeFile("settings.json",JSON.stringify(config))
debug("Write File 1: "+"settings.json")
debug("Create Empty File: "+new_obj.id+".json")
writeFile("json\\"+new_obj.id.replace(/(.*?)-/,"")+".json","[]")
jstree.jstree('edit',new_obj.id,!1)}}}}}}else if(node.type==="1"){return{"Create":{"separator_before":!1,"separator_after":!1,"label":"Create","action":function(obj){node_type="2"
duplicate=!0
i=0
while(duplicate){text="New Tool"
if(i>0){text+=" "+i}
if(check_duplicate_text(node,text)==!0){i++}else{duplicate=!1
new_obj={"id":node.id+"-"+text,"text":text,"type":"2","parent":node.parent,data:{"cmd":text,"desc":"","www":"","license":"","url":"","param":"","previous_text":text}}
debug("node.parent "+node.parent)
jstree.jstree("create_node",node.id,new_obj,"first");debug("create tool "+node.text)
write_category(node.id)
debug("Write File: "+node.id+".json")}}}},"Rename":{"separator_before":!1,"separator_after":!1,"label":"Rename","action":function(obj){jstree.jstree('edit',node)}},"Delete":{"separator_before":!1,"separator_after":!1,"label":"Delete","action":function(obj){delete_node(node)}}}}else{return{"Edit":{"separator_before":!1,"separator_after":!1,"label":"Edit","action":function(obj){show_edit(node.id,node.text,node.parent,node.data.cmd,node.data.desc,node.data.www,node.data.license,node.data.url)}},"Delete":{"separator_before":!1,"separator_after":!1,"label":"Delete","action":function(obj){delete_node(node)}}}}}},'dnd':{'is-draggable':!0,'check-while-dragging':!0,'drag_selection':!1},"types":{"0":{"max_children":1},"1":{},"2":{}}})
jstree.on("create_node.jstree",function(e,data){debug("create_node.jstree")
if(data.node.type=="2"){show_edit(data.node.id,data.node.text,data.node.parent,data.node.data.cmd,data.node.data.param,data.node.data.desc,data.node.data.www,data.node.data.license,data.node.data.url)}
jstree.jstree(!0).select_node(data.node.id)
jstree.jstree(!0).deselect_node(data.node.parent)})
jstree.on('keydown.jstree','.jstree-anchor',function(e){if(e.keyCode>=37&&e.keyCode<=40){debug("keydown")
node=jstree.jstree(!0).get_selected(!0)
if(node[0].type==="2"){show_desc()
show_preview(node)}}})
jstree.on("rename_node.jstree",function(e,data){debug("rename_node.jstree")
var node=data.node
if(node.text===node.data.previous_text){log("Nothing changed")
return(!1)}
if(node.type==="0"){log("Renaming root is not allowed")
return(!1)}
if(node.type==="1"){cat_index=$.inArray(node.data.previous_text,config.categories)
config.categories[cat_index]=node.text
writeFile("settings.json",JSON.stringify(config))
debug("Update settings.json")
if(fso.fileExists("json\\"+node.data.previous_text+".json")){try{fso.MoveFile("json\\"+node.data.previous_text+".json","json\\"+node.text+".json")
debug("Move File:"+"json\\"+node.data.previous_text+".json, "+"json\\"+node.text+".json")}catch(e){log("Failed to rename file: json\\"+node.data.previous_text+".json")}}
set_id(node,node.parent+"-"+node.text)
node.data.previous_text=node.text
update_children_ids(node.text)}else if(node.type==="2"){set_id(node,node.parent+'-'+node.text)
write_category(node.parent)
show_desc()}
right_click=!1})
jstree.on("select_node.jstree",function(e,data){debug("node.id: "+data.node.id)})
jstree.on('click','.jstree-anchor',function(e,data){$('#search').val('')
$('#tree').jstree(!0).toggle_node(e.target);var e=window.event||event;var button=e.which||e.button;if(button==3){}else{$("#desc").html('')
node=$("#tree").jstree(!0).get_node($(".jstree-clicked").attr("id"))
if(node.type==='2'){show_desc()
show_preview(node)}}})
jstree.on('dblclick','.jstree-anchor',function(e){nodes=jstree.jstree("get_selected",!0)
if(nodes.length>0){if(nodes[0].type=="2"){show_edit(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url)}}})
jstree.on('open_node.jstree',function(e,data){var nodesToKeepOpen=[];$('#'+data.node.id).parents('.jstree-node').each(function(){nodesToKeepOpen.push(this.id)});nodesToKeepOpen.push(data.node.id);$('.jstree-node').each(function(){if(nodesToKeepOpen.indexOf(this.id)===-1){$("#tree").jstree().close_node(this.id)}})})
$(document).on('dnd_stop.vakata',function(e,data){var node=jstree.jstree(!0).get_node(data.data.nodes[0]);var targetNode=jstree.jstree(!0).get_node($(data.event.target));n=node.id.split("-")
s=""
previous_node_text=""
for(var i=0;i<2;i++){s+=n[i]+"-"
if(i==1){previous_node_text=n[i]}}
jstree.jstree(!0).set_id(data.data.nodes[0],node.id.replace(s,node.parent+"-"))
debug("New ID: "+node.id)
write_category(targetNode.id)
write_category(trim_char(s,"-"))})
$("#run").on("click",function(e,remote){remote=(remote||!1)
if($("#preview").val().trim()===""){log("Nothing to run")
return(!1)}
param=$("#param").val().trim()
if(param.includes("#")){log("Param should not have #")
blink_element($("#param"))
return(!1)}
if($("#host").val().includes("@")){log("Host should not have @")
blink_element($("#host"))
return(!1)}
params_entered=(param==="")?[]:param.split(",").map(function(item){return item.trim()});params_entered=params_entered.filter(Boolean)
node=jstree.jstree(!0).get_selected(!0)[0]
if(node){action=node.data.cmd
action=(action[0]==="#")?action=action.substring(2.-1):action
needed_count=(action.match(/#/g)||[]).length
if(needed_count>params_entered.length){log("Not enough parameters")
blink_element($("#param"))
return(!1)}}
go($('#host').val(),$("#preview").val(),remote)})
$("#remote").on("click",function(e){$("#run").trigger("click",!0)})
$("#param").on("keyup",function(){node=jstree.jstree("get_selected",!0)
show_preview(node[0])})
$("#optimize").on("click",function(e){really_go('',config.optimize,'',!1)})
$(".dropdown-item").on('click',function(e){$("#quickTools").text($(this).text());$("#quickTools").val($(this).text());$.data(document.body,"quickTools",$.data(document.body,$(this).text()))
$("#quickTools").trigger("click")})
$("#quickTools").on("click",function(){go($("#host").val(),$.data(document.body,"quickTools"),!1)})
$("#copy").on("click",function(){if($("#out").val()!=""){copyToClipboard(document.getElementById("out"))}})
$("#save_output").on("click",function(){if($("#out").val()!=""){d=new Date().toLocaleString().replace(/(\/|\:)/g,"_")
date_string=d.replace(",","")
filename=window.prompt("Enter filename","c:\\techtools_"+date_string+".txt")
if(filename){filename=filename.trim()
if(filename.length>0){writeFile(filename,$("#out").val())}}}})
$("#clear").on("click",function(){$("#out").val('')})
var to=!1;$('#search').keyup(function(){if(to){clearTimeout(to)}
to=setTimeout(function(){var v=$('#search').val();$('#tree').jstree(!0).search(v)},250)});$(document).on('click','a[href]',function(e){e.preventDefault()
if(e.target.className==="external"){openURL(e.target.href)}})
jwerty.key('alt+d',function(e){nodes=jstree.jstree(!0).get_selected(!0)
delete_node(node[0])})
jwerty.key('alt+e',function(e){nodes=jstree.jstree(!0).get_selected(!0)
if(nodes[0].type==="1"){jstree.jstree(!0).edit(nodes[0])}else if(nodes[0].type==="2"){show_edit(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url)}else{log("Edit function not available at this time. Select a tool first.")}
return(!1)})
jwerty.key('alt+r',function(e){$("#run").trigger("click")})
jwerty.key('alt+m',function(e){$("#remote").trigger("click")
return(!1)})
jwerty.key('alt+o',function(e){$("#optimize").trigger("click")
return(!1)})
jwerty.key('alt+q',function(e){$("#quicktools").trigger("click")
return(!1)})
jwerty.key('alt+s',function(e){if($("#form_tool").length>0){$("#btnSave").trigger("click")}else{log("Save function not available at this time. Select a tool first.")}return(!1)})
jwerty.key('alt+c',function(e){$("#out").val("")})
jwerty.key('esc',function(e){if($("#btnCancel").length>0){$("#btnCancel").trigger("click")}})
$(".clearable").each(function(){var $inp=$(this).find("input:text"),$cle=$(this).find(".clearable__clear");$inp.on("input",function(){$cle.toggle(!!this.value)});$cle.on("touchstart click",function(e){e.preventDefault();$inp.val("").trigger("input");node=jstree.jstree(!0).get_selected(!0)
show_preview(node[0])})})})
function show_preview(node){debug("show preview")
if(node){if(node.data.cmd==undefined){return(!1)}
hosts=$("#host").val().trim()
action=node.data.cmd
if(action.includes("@")&&hosts!=""){action.replace(/@/,hosts)}
cmdline=!1
if(action[0]==="#"){action=action.substring(2.-1)
cmdline=!0}
param=$("#param").val().trim()
params=(param=="")?[]:param.split(",")
for(var i=0;i<params.length;i++){if(params[i].trim()){action=action.replace("#",params[i])}}
if(cmdline){$("#preview").val("#"+action)}else{$("#preview").val(action)}}}
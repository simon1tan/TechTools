String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)};var r=null,t=!1,o=new ActiveXObject("Scripting.FileSystemObject");function a(t){var e=new ActiveXObject("Scripting.FileSystemObject");if(e.fileExists(t)){s="";try{f=e.GetFile(t);for(var n=f.OpenAsTextStream(1,-2);!n.AtEndOfStream;)s=s+n.readline()+"\n"}catch(e){return $("#out").val("!! Error reading file, "+t+"!!"),""}finally{n.close()}return s}return!1}function c(t,e){try{var n=new ActiveXObject("Scripting.FileSystemObject");f=n.OpenTextFile(t,2,!0),f.Write(e)}catch(e){return $("#out").val("!! Error reading file, "+t+"!!"),""}finally{f.Close()}}function l(e,t,n,o){for(;t.includes("@");)t=t.replace("@",e);if(n){if(""===e)return m("Remote host must be filled in."),blink_element($("#host")),!1;t=config.remote+" \\\\"+e+" "+t}p(t),oShell=new ActiveXObject("WScript.shell"),$("body").addClass("busy");try{if(o){for(oExec=oShell.Exec(t),output="";!oExec.StdOut.AtEndOfStream;)output+=oExec.StdOut.ReadLine()+"\n";for(;!oExec.StdErr.AtEndOfStream;)output+=oExec.StdErr.ReadLine()+"\n";m("Executing program#: "+t+"\n"+output)}else m("Executing program: "+t),bWaitOnReturn=!1,intWindowStyle=1,oShell.run(t,intWindowStyle,bWaitOnReturn)}catch(e){m("Unable to perform action: "+t+". Check that the path is correct.")}finally{$("body").removeClass("busy")}}function u(e,n,o){return e=trim_char(e.trim(),","),n.includes("@")&&""==e.trim()?(m("Please enter a host"),blink_element($("#host")),!1):(cmdline=!1,"#"===n[0]&&(n=n.substring(1),cmdline=!0),n.includes("@")&&e.includes(",")?(e=e.split(","),$.each(e,function(e,t){l(t.trim(),n,o,cmdline)}),!0):void l(e.trim(),n,o,cmdline))}function p(e){t&&m(e)}function m(e){d=new Date,$("#out").val(d.toUTCString()+": "+e+"\n"+$("#out").val())}function j(){node=$("#tree").jstree(!0).get_selected(!0),node=node[0],s="",node.text&&(s+=node.text+"<br>"),node.data.cmd&&(s+="Command: "+node.data.cmd+"<br>"),node.data.param&&(s+="Paramenters: "+node.data.param+"<br>"),node.data.desc&&(s+="Description: "+node.data.desc+"<br>"),node.data.www&&(s+='Web: <a href="'+node.data.www+'" class=external target=_blank>'+node.data.www+"</a><br>"),node.data.url&&(s+='File: <a href="'+node.data.url+'" class=external target=_blank>'+node.data.url+"</a><br>"),node.data.license&&(s+="License: "+node.data.license+"<br>"),""==s?$("#desc").html("No details to show"):$("#desc").html(s)}function g(e,t,n,o,a,i,r,s,d){s=s?_(s):"",d=d?_(d):"",a=a?_(a):"",r=r?_(r):"",o=o?_(o):"",i=i?_(i):"",$("#desc").html("<form id=form_tool><input type=hidden id=parent value='"+n+"'><label>Name:</label><input id=text value='"+t+"'><label>Description:</label><input id=desc1 value='"+i+"'><label>Command:</label><input id=cmd value='"+o+"'><label>Parameters:</label><input id=param1 value='"+a+"'><label>WWW:</label><input id=www value='"+r+"'><label>License:</label><input id=license value='"+s+"'><label>URL:</label><input id=url value='"+d+'\'><div><input id=btnCancel type="button" value=Cancel onclick="show_desc()" style="width:30%;margin-left:60px"><input type=button id=btnSave onclick="save_edit(this.form)" value=Save></div></form>'),$("#text").focus(),$("#text").select(),$("#form_tool").dirrty({preventLeaving:!1}).on("dirty",function(){$("#btnSave").prop("disabled",!1)}).on("clean",function(){$("#btnSave").prop("disabled",!0)})}function e(e){return $("#form_tool").dirrty("isDirty")?""===e.cmd.value||""===e.text.value?(m("Name and Command must be filled in"),!1):(obj={},obj.id=e.parent.value.trim()+"-"+e.text.value.trim(),obj.text=e.text.value.trim(),obj.data={},obj.data.cmd=e.cmd.value.trim(),obj.data.param=e.param1.value.trim(),obj.data.desc=e.desc1.value.trim(),obj.data.www=e.www.value.trim(),obj.data.url=e.url.value.trim(),obj.data.license=e.license.value.trim(),selected_node=r.jstree(!0).get_selected(!0),selected_node[0].text!==obj.text&&(json=r.jstree(!0).get_json(e.parent.value,{flat:!0}),texts=jsonQ(json).find("text").value(),-1<$.inArray(obj.text,texts))?(m("Name conflicts with existing node. Must be unique."),blink_element($("#text")),!1):(m("Saved "+obj.text),selected_node[0].data=obj.data,r.jstree(!0).set_text(selected_node[0],obj.text),x(selected_node[0],obj.id),j(),S(selected_node[0]),void b(selected_node[0].parent))):(m("No changes to save"),!1)}function _(e){return e=e.replace(/'/gim,"&apos;")}function h(e,o){var a=!1;return $.each(e.children,function(e,t){if(n=$("#tree").jstree(!0).get_node(t),n.text===o)return a=!0}),a}function b(e){json=r.jstree(!0).get_json(e,{flat:!0}),json.shift(),container=[],$.each(json,function(e,t){new_obj={},new_obj.text=t.text,new_obj.cmd=t.data.cmd,new_obj.desc=t.data.desc,new_obj.www=t.data.www,new_obj.license=t.data.license,new_obj.url=t.data.url,new_obj.param=t.data.param,container.push(new_obj)}),filename="json\\"+e.replace(/(.*?)-/,"")+".json",c(filename,JSON.stringify(container)),p("Write tool 1: "+filename)}function v(e){if(json=r.jstree(!0).get_json(e,{flat:!0}),0==json||json.length<2)return p("update_children_ids, no children: "+e),!1;p("update_children_ids: "+e),json.shift(),$.each(json,function(e,t){x(t=r.jstree(!0).get_node(t.id),t.parent+"-"+t.text)})}function x(e,t){anchor=t+"_anchor",$("#"+fix_jquery_selector(e.id)+"_anchor").attr("id",anchor),$("#"+fix_jquery_selector(e.id)).attr("aria-labelledby",anchor),e.a_attr.id=anchor,r.jstree(!0).set_id(e,t)}function w(e){switch(e.type){case"0":m("Not allowed to delete root");break;case"1":answer=confirm("Really delete category?"),answer&&(index=$.inArray(e.text,config.categories),config.categories.splice(index,1),c("settings.json",JSON.stringify(config)),p("Write File 1: settings.json"),o.fileExists("json\\"+e.text+".json")&&(o.DeleteFile("json\\"+e.text+".json"),p("DeleteFile json\\"+e.text+".json")),r.jstree("delete_node",e),$("#desc").html(""));break;case"2":answer=confirm("Really delete tool?"),answer&&(r.jstree("delete_node",e),b(e.parent),$("#desc").html(""))}}$("#search").val(""),$("#preview").val(""),$("#out").val("");r=null;var y=null,k=null;function S(e){if(p("show preview"),e){if(null==e.data.cmd)return!1;hosts=$("#host").val().trim(),action=e.data.cmd,action.includes("@")&&""!=hosts&&action.replace(/@/,hosts),cmdline=!1,"#"===action[0]&&(action=action.substring(1),cmdline=!0),param=$("#param").val().trim(),params=""==param?[]:param.split(",");for(var t=0;t<params.length;t++)params[t].trim()&&(action=action.replace("#",params[t]));cmdline?$("#preview").val("#"+action):$("#preview").val(action)}}$(document).ready(function(){var t=!1;if(window.moveTo(0,0),window.resizeTo(screen.width,screen.height),$("#desc").html(""),o.fileExists("json\\quickTools.json")){try{qt=JSON.parse(a("json\\quickTools.json"))}catch(e){p("!! Error reading json\\quickTools.json!!")}$.each(qt,function(e,t){$(".dropdown-menu").append("<a class='dropdown-item' href='#'>"+t.text+"</a>").data(),$.data(document.body,t.text,t.cmd),t.default&&($("#quickTools").text(t.text),$("#quickTools").val(t.text),$.data(document.body,"quickTools",t.cmd))})}else p("!! Error reading json\\quickTools.json. Make sure file exists!!"),t=!0;if(p("Reading settings.json"),o.fileExists("settings.json"))try{config=JSON.parse(a("settings.json"))}catch(e){return $("#out").val("!! Error reading settings.json. Please validate the JSON data!!"),!1}else $("#out").val("!! Error reading settings.json. Make sure file exists!!"),t=!0;config.sort_categories&&(p("Sorting categories"),config.categories=config.categories.quickSort()),p("Populating jstree"),root_id="0",cats=[],$.each(config.categories,function(e,n){cats.push({id:root_id+"-"+n,text:n,type:"1",data:{previous_text:n}}),p("\tReading json\\"+n+".json");try{tools=JSON.parse(a("json\\"+n+".json"))}catch(e){m("!! Error reading json\\"+n+".json. Please validate the JSON data!!"),t=!0}$.each(tools,function(e,t){t.cmd&&(tools[e].id=root_id+"-"+n+"-"+t.text,tools[e].text=t.text,tools[e].type="2",tools[e].data={desc:t.desc,www:t.www,license:t.license,url:t.url,param:t.param,cmd:t.cmd,previous_text:t.text})}),cats[e].children=tools}),t?m("Loading complete with errors"):$("#out").val("Loading Complete"),config.sort_tools&&(jsonQ.settings.sort.caseIgnore=!0,cats=jsonQ(cats).sort("text").jsonQ_root),jsondata=[{id:root_id,text:"TechTools",type:"0",state:{opened:!0},children:cats,data:{disable_close:!0}}],(r=$("#tree").jstree({core:{check_callback:function(e,t,n,o,a){switch(e){case"rename_node":return"0"===t.type;case"move_node":return"2"===t.type&&"1"===n.type;default:return!0}},scroll:!0,dblclick_toggle:!1,multiple:!1,animation:0,data:jsondata},plugins:["unique","search","contextmenu","types","dnd"],contextmenu:{items:function(t){return right_click=!0,p("contextmenu"),"0"===t.type?{Create:{separator_before:!1,separator_after:!1,label:"Create",action:function(e){for(k="1",duplicate=!0,i=0;duplicate;)text="New Category",0<i&&(text+=" "+i),1==h(t,text)?i++:(duplicate=!1,new_obj={id:t.id+"-"+text,text:text,type:"1",parent:"0",children:[],data:{previous_text:text}},r.jstree("create_node",t.id,new_obj,"first"),config.categories.unshift(text),c("settings.json",JSON.stringify(config)),p("Write File 1: settings.json"),p("Create Empty File: "+new_obj.id+".json"),c("json\\"+new_obj.id.replace(/(.*?)-/,"")+".json","[]"),r.jstree("edit",new_obj.id,!1))}}}:"1"===t.type?{Create:{separator_before:!1,separator_after:!1,label:"Create",action:function(e){for(k="2",duplicate=!0,i=0;duplicate;)text="New Tool",0<i&&(text+=" "+i),1==h(t,text)?i++:(duplicate=!1,new_obj={id:t.id+"-"+text,text:text,type:"2",parent:t.parent,data:{cmd:text,desc:"",www:"",license:"",url:"",param:"",previous_text:text}},p("node.parent "+t.parent),r.jstree("create_node",t.id,new_obj,"first"),p("create tool "+t.text),b(t.id),p("Write File: "+t.id+".json"))}},Edit:{separator_before:!1,separator_after:!1,label:"Edit",action:function(e){r.jstree("edit",t)}},Delete:{separator_before:!1,separator_after:!1,label:"Delete",action:function(e){w(t)}}}:{Edit:{separator_before:!1,separator_after:!1,label:"Edit",action:function(e){g(t.id,t.text,t.parent,t.data.cmd,t.data.desc,t.data.www,t.data.license,t.data.url)}},Delete:{separator_before:!1,separator_after:!1,label:"Delete",action:function(e){w(t)}}}}},dnd:{"is-draggable":!0,"check-while-dragging":!0,drag_selection:!1},types:{0:{max_children:1},1:{},2:{}}})).on("create_node.jstree",function(e,t){p("create_node.jstree"),"2"==t.node.type&&g(t.node.id,t.node.text,t.node.parent,t.node.data.cmd,t.node.data.param,t.node.data.desc,t.node.data.www,t.node.data.license,t.node.data.url),r.jstree(!0).select_node(t.node.id),r.jstree(!0).deselect_node(t.node.parent)}),r.on("keydown.jstree",".jstree-anchor",function(e){37<=e.keyCode&&e.keyCode<=40&&(p("keydown"),node=r.jstree(!0).get_selected(!0),"2"===node[0].type&&(j(),S(node)))}),r.on("rename_node.jstree",function(e,t){var n=t.node;if(n.text===n.data.previous_text)return m("Nothing changed"),!1;if("0"===n.type)return m("Renaming root is not allowed"),!1;if(p("rename_node.jstree"),"1"===n.type){if(cat_index=$.inArray(n.data.previous_text,config.categories),config.categories[cat_index]=n.text,c("settings.json",JSON.stringify(config)),p("Update settings.json"),o.fileExists("json\\"+n.data.previous_text+".json"))try{o.MoveFile("json\\"+n.data.previous_text+".json","json\\"+n.text+".json"),p("Move File:json\\"+n.data.previous_text+".json, json\\"+n.text+".json")}catch(e){m("Failed to rename file: json\\"+n.data.previous_text+".json")}x(n,n.parent+"-"+n.text),n.data.previous_text=n.text,v(n.text)}else"2"===n.type&&(x(n,n.parent+"-"+n.text),b(n.parent),j());right_click=!1}),r.on("select_node.jstree",function(e,t){p("node.id: "+t.node.id)}),r.on("click",".jstree-anchor",function(e,t){$("#search").val(""),$("#tree").jstree(!0).toggle_node(e.target),3==((e=window.event||event).which||e.button)||($("#desc").html(""),node=$("#tree").jstree(!0).get_node($(".jstree-clicked").attr("id")),"2"===node.type&&(j(),S(node)))}),r.on("dblclick",".jstree-anchor",function(e){nodes=r.jstree("get_selected",!0),0<nodes.length&&"2"==nodes[0].type&&g(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url)}),r.on("open_node.jstree",function(e,t){var n=[];$("#"+t.node.id).parents(".jstree-node").each(function(){n.push(this.id)}),n.push(t.node.id),$(".jstree-node").each(function(){-1===n.indexOf(this.id)&&$("#tree").jstree().close_node(this.id)})}),$(document).on("dnd_stop.vakata",function(e,t){var o=r.jstree(!0).get_node(t.data.nodes[0]),a=r.jstree(!0).get_node($(t.event.target));n=o.id.split("-"),s="",previous_node_text="";for(var i=0;i<2;i++)s+=n[i]+"-",1==i&&(previous_node_text=n[i]);r.jstree(!0).set_id(t.data.nodes[0],o.id.replace(s,o.parent+"-")),p("New ID: "+o.id),b(a.id),b(trim_char(s,"-"))}),$("#run").on("click",function(e,t){return t=t||!1,""===$("#preview").val().trim()?(m("Nothing to run"),!1):(param=$("#param").val().trim(),param.includes("#")?(m("Param should not have #"),blink_element($("#param")),!1):$("#host").val().includes("@")?(m("Host should not have @"),blink_element($("#host")),!1):(params_entered=""===param?[]:param.split(",").map(function(e){return e.trim()}),params_entered=params_entered.filter(Boolean),node=r.jstree(!0).get_selected(!0)[0],node&&(action=node.data.cmd,action="#"===action[0]?action=action.substring(1):action,needed_count=(action.match(/#/g)||[]).length,needed_count>params_entered.length)?(m("Not enough parameters"),blink_element($("#param")),!1):void u($("#host").val(),$("#preview").val(),t)))}),$("#remote").on("click",function(e){$("#run").trigger("click",!0)}),$("#param").on("keyup",function(){node=r.jstree("get_selected",!0),S(node[0])}),$("#optimize").on("click",function(e){l("",config.optimize,"",!1)}),$(".dropdown-item").on("click",function(e){$("#quickTools").text($(this).text()),$("#quickTools").val($(this).text()),$.data(document.body,"quickTools",$.data(document.body,$(this).text())),$("#quickTools").trigger("click")}),$("#quickTools").on("click",function(){u($("#host").val(),$.data(document.body,"quickTools"),!1)}),$("#copy").on("click",function(){""!=$("#out").val()&&copyToClipboard(document.getElementById("out"))}),$("#save_output").on("click",function(){""!=$("#out").val()&&(d=(new Date).toLocaleString().replace(/(\/|\:)/g,"_"),date_string=d.replace(",",""),filename=window.prompt("Enter filename","c:\\techtools_"+date_string+".txt"),filename&&(filename=filename.trim(),0<filename.length&&c(filename,$("#out").val())))}),$("#clear").on("click",function(){$("#out").val("")});var e=!1;$("#search").keyup(function(){e&&clearTimeout(e),e=setTimeout(function(){var e=$("#search").val();$("#tree").jstree(!0).search(e)},250)}),$(document).on("click","a[href]",function(e){e.preventDefault(),"external"===e.target.className&&openURL(e.target.href)}),jwerty.key("alt+d",function(e){nodes=r.jstree(!0).get_selected(!0),w(node[0])}),jwerty.key("alt+e",function(e){return nodes=r.jstree(!0).get_selected(!0),"1"===nodes[0].type?r.jstree(!0).edit(nodes[0]):"2"===nodes[0].type?g(nodes[0].id,nodes[0].text,nodes[0].parent,nodes[0].data.cmd,nodes[0].data.param,nodes[0].data.desc,nodes[0].data.www,nodes[0].data.license,nodes[0].data.url):m("Edit function not available at this time. Select a tool first."),!1}),jwerty.key("alt+r",function(e){$("#run").trigger("click")}),jwerty.key("alt+m",function(e){return $("#remote").trigger("click"),!1}),jwerty.key("alt+o",function(e){return $("#optimize").trigger("click"),!1}),jwerty.key("alt+q",function(e){return $("#quicktools").trigger("click"),!1}),jwerty.key("alt+s",function(e){return 0<$("#form_tool").length?$("#btnSave").trigger("click"):m("Save function not available at this time. Select a tool first."),!1}),jwerty.key("alt+c",function(e){$("#out").val("")}),jwerty.key("esc",function(e){0<$("#btnCancel").length&&$("#btnCancel").trigger("click")}),$(".clearable").each(function(){var t=$(this).find("input:text"),e=$(this).find(".clearable__clear");t.on("input",function(){e.toggle(!!this.value)}),e.on("touchstart click",function(e){e.preventDefault(),t.val("").trigger("input")})})});